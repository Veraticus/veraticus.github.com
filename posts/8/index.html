
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Hi, I&#8217;m Josh Symonds</title>
  <meta name="author" content="Josh Symonds">

  
  <meta name="description" content="Keeping a highly available web application online is no joke. Everything above 99% is extremely impressive; that means that you battled the forces &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://joshsymonds.com/posts/8">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Hi, I'm Josh Symonds" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="//code.highcharts.com/highcharts.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <script type="text/javascript" src="//use.typekit.net/vkg2ijz.js"></script>
<script type="text/javascript">try{Typekit.load();}catch(e){}</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript">
  $.noConflict();
  jQuery(document).ready(function($) {
    var stickyTop = $('nav').offset().top; // returns number
    $(window).scroll(function(){ // scroll event
      var windowTop = $(window).scrollTop(); // returns number
      $('nav').toggleClass('sticky', (stickyTop < windowTop))
    });
  });
</script>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-29421607-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body >
  <header role="banner"><hgroup>
  <img id='avatar' src="/images/josh_circle.png" />
  <div class='arrow_box'>
    <h1><a href="/">Hi, I&#8217;m Josh Symonds</a></h1>
    
      <h2>I blog about Ruby on Rails, coding, and servers</h2>
    
  </div>
</hgroup>

</header>
  <nav role="navigation"><div id='navigation'>
  <ul class="subscription" data-subscription="rss">
    <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
    
  </ul>
    
  <form action="https://www.google.com/search" method="get">
    <fieldset role="search">
      <input type="hidden" name="q" value="site:joshsymonds.com" />
      <input class="search" type="text" name="q" results="0" placeholder="Search"/>
    </fieldset>
  </form>
    
  <ul class="main-navigation">
  <li id='logo'><a href="/">Josh Symonds</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/resume/">Resum&#233;</a></li>
</ul>

</div></nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/09/achieving-100-percent-uptime/">Achieving 100% Uptime</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-09T17:52:00-05:00" pubdate data-updated="true"></time>
        <span class='readtime'>Reading time 4  minutes</span>

        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="http://f.cl.ly/items/0q2M3B2o1f1D1D451B1S/uptime.jpg" alt="Uptime - 100%" /></p>

<p>Keeping a highly available web application online is no joke. Everything above 99% is extremely impressive; that means that you battled the forces of <a href="http://en.wikipedia.org/wiki/Software_erosion">erosion</a> and probably even deployed some pretty neat features without even a hiccup from your users&#8217; perspective. I always feel great when I get our weekly <a href="http://newrelic.com/">New Relic</a> status report email &ndash; it&rsquo;s a good indication of how well I did my job in the previous week. And for a couple weeks now I&rsquo;m happy to report I&rsquo;ve been very proud indeed, with 100% uptime on the Hipstamatic web application.</p>

<p>How do you achieve numbers like these? Unfortunately getting to 100% isn&rsquo;t an easy road, and I want to state up front that I also don&rsquo;t think it&rsquo;s a realistic goal. Issues you can&rsquo;t control can ruin your uptime number, and you shouldn&rsquo;t feel broken up about that. It happens to everybody. But it&rsquo;s always good setting goals that are difficult to achieve, and this one is no different.</p>

<p>So what&rsquo;s the secret to 100% uptime?</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/04/09/achieving-100-percent-uptime/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/06/how-i-scaled-hipstamatic/">How I Scaled Hipstamatic</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-06T10:58:00-05:00" pubdate data-updated="true"></time>
        <span class='readtime'>Reading time 5  minutes</span>

        
      </p>
    
  </header>


  <div class="entry-content"><p>The <a href="http://joshsymonds.com/blog/2012/04/03/how-to-refactor-a-large-and-old-project/">Proper Refactoring</a> proceeds apace, but I think in my last post I gave the impression that the Hipstamatic Rails project is inefficient or, even worse, slow. Nothing could be further from the truth; over the course of two years I&rsquo;ve been continuously improving the project to be more responsive and much, much faster. How much faster? Well, unfortunately, I don&rsquo;t have metrics from the first months I worked at Synthetic. But we were using XML and then plist to generate our responses to the iPhone app, and that process was achingly slow: I would estimate 200ms on average.</p>

<p>Now, take a look at our average response time over the last month.</p>

<p><img src="http://f.cl.ly/items/1H0v0C420X0a1O3Y2p3Y/Hipstaweb%20-%20New%20Relic-1.jpg" alt="Average response time - 115ms" /></p>

<p>Considering the web of external services Hipstamatic depends on for much of its operation, I&rsquo;m proud of our 115ms average response time. Proud but not satisfied &ndash; hence the need for the Proper Refactoring, and I am optimistic that it will lead to a net performance gain for us and our users. There&rsquo;s no reason we can&rsquo;t achieve 50-70ms response times with better caching and slimmer applications.</p>

<p>Over the same time period that our response time has dropped, our user base has grown exponentially, and so too our traffic. At the beginning of my tenure at Synthetic our site was receiving close to 100,000 hits a day, and nearly all of that web traffic: now <a href="http://community.hipstamatic.com">community.hipstamatic.com</a> sees about a million requests a day, most of that API traffic generated from our iPhone applications. That&rsquo;s an enormous amount of growth, and much of that over the course of just one or two explosive months.</p>

<p>Synthetic is <a href="http://heysynthetic.com/about_us/">a team</a> of extremely talented individuals. But as our main Rails programmer and only server administrator, I wanted to discuss the lessons I personally learned in making Hipstamatic&rsquo;s web site and web services fast. (Or, at the very least, a lot faster.)</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/04/06/how-i-scaled-hipstamatic/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/04/03/how-to-refactor-a-large-and-old-project/">How to Refactor a Large and Old Project</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-03T10:06:00-05:00" pubdate data-updated="true"></time>
        <span class='readtime'>Reading time 3  minutes</span>

        
      </p>
    
  </header>


  <div class="entry-content"><p>The Rails application backing Hipstamatic is very, very large. It started over two years ago as a Rails 2.1 project, and has been continuously improved since then &ndash; moving to Rails 3.2, adding in redis and resque, and then adding in elasticsearch. During that time the database has bounced around continuously in size and importance as we move data from MySQL to data stores that are <a href="http://joshsymonds.com/blog/2012/03/25/elasticsearch-and-percolation-in-rails/">better suited for it</a>. And while at the start it handled only contests and submissions, since then we&rsquo;ve added in orders, the family album, D-Series support, and even more exciting behind-the-scenes stuff.</p>

<p>And as you can imagine from a project that&rsquo;s undergone continuous improvement for a long time, it&rsquo;s kind of a mess. A lot of stuff was done without an eye towards our future needs, and, even more embarrassingly, a lot of stuff was done with a future need in mind &ndash; and, of course, that need never materialized, so the code is named or structured improperly.</p>

<p>The temptation with any project as large and old as this is to do <a href="http://chadfowler.com/2006/12/27/the-big-rewrite">the Big Rewrite</a>. I&rsquo;ve been involved in a few of those, and my advice regarding them is quite simple:</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/04/03/how-to-refactor-a-large-and-old-project/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/31/ruby-in-the-sandbox-sandrbox/">Ruby in the Sandbox: SandRBox</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-31T11:19:00-05:00" pubdate data-updated="true"></time>
        <span class='readtime'>Reading time 3  minutes</span>

        
      </p>
    
  </header>


  <div class="entry-content"><p>I volunteer in the cyber center at the <a href="http://www.centeronhalsted.org/">Center on Halsted</a>. They&rsquo;re always looking for people to teach new classes, so I figured I would teach an introduction to programming class &ndash; an introduction through Ruby. Besides being my favorite computer language, I think Ruby makes a great beginner&rsquo;s language: it has none of the strange, computer-oriented concepts that make most programming languages difficult to learn, and it even reads like pure, simple English. Instead of pointers and variable typing, you have sensible enumerators and object orientation. And also it&rsquo;s super fun.</p>

<p>Unfortunately, getting stuff installed on the computers at the cyber center is kind of a headache. Like most chronically underfunded but well-meaning institutions, there are about three levels of bureaucracy between you and getting anything done. And teaching Ruby without the aid of irb would be next to impossible. So what&rsquo;s a guy to do?</p>

<p>Simple: <a href="http://sandrbox.herokuapp.com/">create irb online</a>.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/03/31/ruby-in-the-sandbox-sandrbox/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/28/delegation-when-delegate-just-wont-work/">Delegation When Delegate Just Won&#8217;t Work</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-28T15:37:00-05:00" pubdate data-updated="true"></time>
        <span class='readtime'>Reading time 2  minutes</span>

        
      </p>
    
  </header>


  <div class="entry-content"><p>Rails provides a really awesome ability to avoid <a href="http://en.wikipedia.org/wiki/Law_of_Demeter">Law of Demeter</a> violations &ndash; the <a href="http://apidock.com/rails/Module/delegate">Module#delegate</a> method. The Law of Demeter is an informal programming guideline, intended to make your code more obvious and more reusable: objects should only call methods on other objects, not objects of those objects. To provide a more concrete example:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="vi">@user</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">street_address</span> <span class="c1"># Law of Demeter violation: @user should not reach into address!</span>
</span><span class='line'>  <span class="vi">@user</span><span class="o">.</span><span class="n">street_address</span> <span class="c1"># So much better...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Rails, because it&rsquo;s cool, provides a quick and easy pattern for making this work:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">has_one</span> <span class="ss">:address</span>
</span><span class='line'>  <span class="n">delegate</span> <span class="ss">:street_address</span><span class="p">,</span> <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="ss">:address</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="no">User</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">street_address</span> <span class="c1"># Calls address.street_address</span>
</span></code></pre></td></tr></table></div></figure>


<p>Check out the <a href="http://apidock.com/rails/Module/delegate">delegate documentation</a> for more information on how this functionality works. But <a href="http://stackoverflow.com/questions/9914400/delegate-all-method-calls-on-a-model-to-an-association">a question I came across on Stack Overflow</a> today asked: what do you when you want to delegate all methods? I do <a href="https://github.com/Veraticus/Dynamoid/blob/master/lib/dynamoid/adapter.rb#L122">something similar in Dynamoid</a> and wanted to talk about how to make this pattern sensible and performant.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/03/28/delegation-when-delegate-just-wont-work/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/25/elasticsearch-and-percolation-in-rails/">Elasticsearch and Percolation in Rails</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-25T11:39:00-05:00" pubdate data-updated="true"></time>
        <span class='readtime'>Reading time 5  minutes</span>

        
      </p>
    
  </header>


  <div class="entry-content"><p>Hipstamatic uses the pretty awesome Family Album feature for people to like and react to each others&#8217; photos. You can create either a magic album &ndash; an album that matches to a combination of criteria including accounts, geolocation, tags and descriptions &ndash; or a curated album, selecting photos directly that you want to include. The latter is a pretty straight-forward association and isn&rsquo;t very interesting to talk about, but I wanted to discuss briefly the methods we used to implement magic albums and what we finally settled on. It involved a lot of setting up elasticsearch and percolation, and ultimately I think it&rsquo;s a very durable, excellent solution for anyone wanting to index a lot of data and retrieve it extremely quickly.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/03/25/elasticsearch-and-percolation-in-rails/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/22/why-i-dont-use-haml/">Why I Don&#8217;t Use Haml</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-22T13:19:00-05:00" pubdate data-updated="true"></time>
        <span class='readtime'>Reading time 2  minutes</span>

        
      </p>
    
  </header>


  <div class="entry-content"><p>I initially thought of titling this post something more inflammatory, like &ldquo;Why Haml Sucks&rdquo; or &ldquo;Only Losers Use Haml.&rdquo; But the truth is <a href="http://haml-lang.com/">Haml</a> does anything but suck. It&rsquo;s actually quite elegant; the syntax is clean, not needing closing tags is just really cool, and it&rsquo;s very fast to read. It seems like it would be an ideal language to replace HTML, just like SASS and CoffeeScript are abstractions of and (to a certain extent) replacements for CSS and JavaScript, respectively.</p>

<p>So why do I bang my head against my desk every time I see someone using it in a view?</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/03/22/why-i-dont-use-haml/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/19/sweeping-caches-from-resque-or-anywhere-really/">Sweeping Caches From Resque (or Anywhere Really)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-19T10:29:00-05:00" pubdate data-updated="true"></time>
        <span class='readtime'>Reading time 1  minute</span>

        
      </p>
    
  </header>


  <div class="entry-content"><p>Phil Karlton, someone I can only presume is a pretty smart programmer, said <a href="http://martinfowler.com/bliki/TwoHardThings.html">&ldquo;there are only two hard things in Computer Science: cache invalidation and naming things.&rdquo;</a> He&rsquo;s totally right; cache invalidation is one of the biggest headaches when designing highly usable, highly available websites and is something that I&rsquo;m sure every Rails programmer worth their salt has struggled with. (Naming things is also a pain but not the focus of this post.)</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/03/19/sweeping-caches-from-resque-or-anywhere-really/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/16/classifying-and-refactoring-your-code/">Classifying and Refactoring Your Code</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-16T00:39:00-05:00" pubdate data-updated="true"></time>
        <span class='readtime'>Reading time 1  minute</span>

        
      </p>
    
  </header>


  <div class="entry-content"><p>Outside of the guiding framework of Rails, it can be difficult to manage your own Ruby code, as I&rsquo;ve discovered in the process of creating <a href="https://github.com/Veraticus/Dynamoid">Dynamoid</a>. MVC provides a clear and concise framework that encapsulates the functionality of most web applications really well; but outside of web applications, exactly where and how to put your code is a lot less clear. I thought I&rsquo;d share some of my experiences and thoughts on doing this in my own Gem in the hopes that the lessons I&rsquo;ve learned will aid others.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/03/16/classifying-and-refactoring-your-code/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/03/13/fnordmetric-native-rails-metrics/">Fnordmetric: Native Rails Metrics</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-03-13T22:05:00-05:00" pubdate data-updated="true"></time>
        <span class='readtime'>Reading time 3  minutes</span>

        
      </p>
    
  </header>


  <div class="entry-content"><p>Over the weekend I spent some time getting <a href="https://github.com/paulasmuth/fnordmetric">Fnordmetric</a> set up in an application. On the surface it looks really cool and quite nifty, but I ran into some trouble getting it configured how I wanted it and figured I&rsquo;d make a post about it. I think I might have been struggling against the conventions in it a little too much, but it was still an instructive battle.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2012/03/13/fnordmetric-native-rails-metrics/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/9">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/7">Newer &rarr;</a>
    
  </div>
</div>

    </div>
  </div>
  <footer role="contentinfo"><div id='footer'>
  <p>
  Copyright &copy; 2015 - Josh Symonds -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</div>
</footer>
  



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
